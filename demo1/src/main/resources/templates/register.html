<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>名片管理系统 - 注册</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .container { margin-top: 80px; }
        .card { box-shadow: 0 0 20px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white text-center">
                    <h4>用户注册</h4>
                </div>
                <div class="card-body">
                    <form th:action="@{/user/register}" method="post" th:object="${user}">
                        <!-- 用户名 -->
                        <div class="mb-3">
                            <label th:for="uname" class="form-label">用户名</label>
                            <input type="text" class="form-control" th:field="*{uname}" placeholder="请输入用户名" id="uname">
                            <div th:if="${#fields.hasErrors('uname')}" th:errors="*{uname}" class="text-danger"></div>
                            <div th:if="${unameError}" class="text-danger" th:text="${unameError}"></div>
                            <div id="unameCheck" class="form-text"></div>
                        </div>
                        <!-- 密码 -->
                        <div class="mb-3">
                            <label th:for="upwd" class="form-label">密码</label>
                            <input type="password" class="form-control" th:field="*{upwd}" placeholder="请输入密码">
                            <div th:if="${#fields.hasErrors('upwd')}" th:errors="*{upwd}" class="text-danger"></div>
                        </div>
                        <!-- 邮箱 -->
                        <div class="mb-3">
                            <label th:for="email" class="form-label">邮箱（可选）</label>
                            <input type="email" class="form-control" th:field="*{email}" placeholder="请输入邮箱">
                        </div>
                        <!-- 注册错误提示 -->
                        <div th:if="${registerError}" class="text-danger text-center mb-3" th:text="${registerError}"></div>
                        <!-- 提交按钮 -->
                        <button type="submit" class="btn btn-success w-100">注册</button>
                    </form>
                    <div class="text-center mt-3">
                        <a th:href="@{/user/login}">已有账号？返回登录</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // 实时检查用户名是否可用
    document.getElementById("uname").onblur = function() {
        let uname = this.value.trim();
        if (uname === "") {
            document.getElementById("unameCheck").innerText = "用户名不能为空";
            document.getElementById("unameCheck").className = "form-text text-danger";
            return;
        }
        axios.get("/card/user/checkUname?uname=" + uname)
            .then(function(response) {
                if (response.data) {
                    document.getElementById("unameCheck").innerText = "用户名可用";
                    document.getElementById("unameCheck").className = "form-text text-success";
                } else {
                    document.getElementById("unameCheck").innerText = "用户名已被占用";
                    document.getElementById("unameCheck").className = "form-text text-danger";
                }
            });
    };
</script>
</body>
</html>