<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>名片列表 - 名片管理系统</title>
    <!-- 引入Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入图标库（用于按钮图标） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
<!-- 引入公共导航栏 -->
<div th:replace="common/header :: body"></div>

<div class="container mt-4">
    <!-- 页面标题 + 添加名片按钮 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>我的名片列表</h2>
        <a th:href="@{/card/addPage}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> 添加名片
        </a>
    </div>

    <!-- 错误提示（删除失败等） -->
    <div class="alert alert-danger" th:if="${errorMsg != null}" role="alert">
        [[${errorMsg}]]
    </div>

    <!-- 名片列表表格 -->
    <div class="card shadow">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover table-bordered">
                    <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>客户姓名</th>
                        <th>电话</th>
                        <th>单位</th>
                        <th>职务</th>
                        <th>Logo</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 遍历名片列表（如果没有数据，显示提示） -->
                    <tr th:if="${cardList.size() == 0}">
                        <td colspan="7" class="text-center text-muted">暂无名片数据，请点击"添加名片"创建</td>
                    </tr>
                    <!-- 循环显示名片数据 -->
                    <tr th:each="card : ${cardList}">
                        <td th:text="${card.id}">1</td>
                        <td th:text="${card.name}">张三</td>
                        <td th:text="${card.telephone}">13800138000</td>
                        <td th:text="${card.company}">XX科技公司</td>
                        <td th:text="${card.post}">产品经理</td>
                        <td>
                            <!-- 显示Logo（如果存在） -->
                            <img
                                    th:if="${card.logoName != null and card.logoName != ''}"
                                    th:src="@{${uploadAccessPath} + ${card.logoName}}"
                                    alt="名片Logo"
                                    style="width: 60px; height: 40px; object-fit: contain;"
                            >
                            <span th:if="${card.logoName == null or card.logoName == ''}" class="text-muted">无</span>
                        </td>
                        <td>
                            <!-- 操作按钮组 -->
                            <div class="btn-group btn-group-sm">
                                <a th:href="@{/card/detail/{id}(id=${card.id})}" class="btn btn-info" title="查看详情">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a th:href="@{/card/updatePage/{id}(id=${card.id})}" class="btn btn-warning" title="修改">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <button class="btn btn-danger delete-btn" th:data-id="${card.id}" title="删除">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 引入公共页脚 -->
<div th:replace="common/footer :: body"></div>

<!-- 引入Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- 新增删除功能脚本 -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    // 删除名片
    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.onclick = function() {
            const id = this.getAttribute("data-id");
            const _this = this; // 保存按钮引用

            if (confirm("确定要删除该名片吗？")) {
                // 禁用按钮并显示加载状态
                _this.disabled = true;
                _this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 删除中...';

                // 发送POST请求
                axios.post("/card/delete", null, {
                    params: { id: id }
                }).then(function(response) {
                    if (response.data) {
                        // 删除成功，刷新页面
                        location.reload();
                    } else {
                        alert("删除失败，该名片可能不存在或已被删除");
                        // 恢复按钮状态
                        _this.disabled = false;
                        _this.innerHTML = '<i class="bi bi-trash"></i>';
                    }
                }).catch(function(error) {
                    // 捕获网络错误
                    alert("删除失败，网络错误请重试");
                    _this.disabled = false;
                    _this.innerHTML = '<i class="bi bi-trash"></i>';
                });
            }
        };
    });
</script>
</body>
</html>